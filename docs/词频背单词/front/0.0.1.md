# Week 1 核心功能产品设计文档 - 前端部分

## 单词记忆应用 - MVP Phase 1 (Frontend)

**版本**: v1.0  
**日期**: 2024-02-16  
**技术栈**: React + Axios + CSS Modules  
**目标**: 实现最小可用产品前端界面，完成核心学习交互闭环

---

## 一、功能模块概览 (用户视角)

```
┌─────────────────────────────────────────────────┐
│              Week 1 前端核心功能范围             │
├─────────────────────────────────────────────────┤
│  1. 词典管理界面                                 │
│     - 文件上传交互                               │
│     - 上传进度实时展示                           │
│     - 词典列表展示                               │
│                                                  │
│  2. 学习界面（核心）                              │
│     - 单词卡片翻转效果                           │
│     - 答题质量评分交互 (0-5)                     │
│     - 学习进度条反馈                             │
│                                                  │
│  3. 全局状态管理                                 │
│     - 用户登录状态 (Mock)                        │
│     - 当前学习任务队列缓存                       │
└─────────────────────────────────────────────────┘
```

---

## 二、项目结构

```
vocabulary-frontend/
├── public/                     # 静态资源
├── src/
│   ├── components/             # 公共组件
│   │   ├── WordCard/           # 单词卡片组件
│   │   ├── QualityButtons/     # 答题质量按钮组
│   │   ├── ProgressBar/        # 进度条
│   │   └── UploadStatus/       # 上传进度组件
│   ├── pages/
│   │   ├── DictionaryUpload/   # 词典上传页
│   │   ├── Learning/           # 学习页面
│   │   └── Dashboard/          # 数据面板 (列表)
│   ├── services/               # API 调用封装
│   │   ├── request.js          # Axios 实例配置
│   │   ├── dictionary.js       # 词典相关接口
│   │   └── learning.js         # 学习相关接口
│   ├── hooks/                  # 自定义 Hooks
│   │   └── useLearning.js      # 学习逻辑封装
│   ├── utils/                  # 工具函数
│   │   └── format.js           # 日期/数字格式化
│   ├── styles/                 # 全局样式
│   │   └── variables.css       # CSS 变量
│   └── App.jsx                 # 入口组件
├── .env                        # 环境变量
└── package.json
```

---

## 三、API 接口对接规范

> 注：详细接口定义见后端文档，此处仅列出前端调用所需的关键信息。

### 3.1 请求封装 (Axios)

```javascript
// src/services/request.js
import axios from 'axios';

const request = axios.create({
  baseURL: process.env.REACT_APP_API_BASE_URL,
  timeout: 10000,
});

// 请求拦截器 (添加 Token 等)
request.interceptors.request.use(config => {
  // config.headers.Authorization = `Bearer ${token}`;
  return config;
});

// 响应拦截器 (统一错误处理)
request.interceptors.response.use(
  response => {
    if (response.data.code !== 0) {
      return Promise.reject(new Error(response.data.message));
    }
    return response.data;
  },
  error => {
    console.error('API Error:', error);
    return Promise.reject(error);
  }
);

export default request;
```

### 3.2 核心接口调用

#### 1. 上传词典
- **Endpoint**: `POST /api/v1/dictionaries/upload`
- **用途**: 用户选择 TXT 文件后触发
- **前端处理**: 使用 `FormData` 封装文件，上传成功后轮询任务状态

#### 2. 查询上传进度
- **Endpoint**: `GET /api/v1/dictionaries/upload/status/:task_id`
- **用途**: 上传页轮询接口 (每 2 秒一次)
- **前端处理**: 根据 `progress` 字段更新进度条，`status === 'completed'` 时跳转列表

#### 3. 获取今日任务
- **Endpoint**: `GET /api/v1/learning/today-tasks`
- **用途**: 进入学习页时加载
- **前端处理**: 缓存返回的 `words` 数组，本地控制卡片切换

#### 4. 提交答题结果
- **Endpoint**: `POST /api/v1/learning/submit`
- **用途**: 用户选择质量评分后触发
- **前端处理**: 发送请求成功后，加载下一张卡片；失败则提示重试

---

## 四、核心组件设计

### 4.1 WordCard 组件 (单词卡片)

**功能**: 展示单词、音标、释义，支持翻转/揭示效果。

```jsx
// src/components/WordCard/index.jsx
import React, { useState } from 'react';
import './styles.css';

const WordCard = ({ word, onReveal }) => {
  const [revealed, setRevealed] = useState(false);
  
  const handleReveal = () => {
    setRevealed(true);
    onReveal();
  };
  
  return (
    <div className="word-card">
      <div className="word-header">
        <h1 className="word-text">{word.word}</h1>
        <span className="phonetic">{word.phonetic}</span>
      </div>
      
      {!revealed ? (
        <button 
          className="reveal-button"
          onClick={handleReveal}
        >
          显示释义
        </button>
      ) : (
        <div className="word-meaning">
          {word.meaning.definitions.map((def, idx) => (
            <div key={idx} className="definition-item">
              <span className="pos">{def.pos}</span>
              <span className="text">{def.text}</span>
            </div>
          ))}
          
          {word.example && (
            <div className="example">
              <label>例句：</label>
              <p>{word.example}</p>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

export default WordCard;
```

### 4.2 QualityButtons 组件 (答题质量选择)

**功能**: 提供 0-5 分的评分按钮，不同分数对应不同颜色。

```jsx
// src/components/QualityButtons/index.jsx
import React from 'react';
import './styles.css';

const QUALITIES = [
  { value: 0, label: '完全不认识', color: '#ff4d4f' },
  { value: 1, label: '有印象', color: '#ff7a45' },
  { value: 2, label: '想起来了', color: '#ffa940' },
  { value: 3, label: '有些犹豫', color: '#ffc53d' },
  { value: 4, label: '轻松想起', color: '#95de64' },
  { value: 5, label: '脱口而出', color: '#52c41a' },
];

const QualityButtons = ({ onSelect, disabled }) => {
  return (
    <div className="quality-buttons">
      <p className="hint">你对这个单词的掌握程度？</p>
      <div className="buttons-grid">
        {QUALITIES.map(q => (
          <button
            key={q.value}
            className="quality-btn"
            style={{ borderColor: q.color }}
            onClick={() => onSelect(q.value)}
            disabled={disabled}
          >
            <span className="value">{q.value}</span>
            <span className="label">{q.label}</span>
          </button>
        ))}
      </div>
    </div>
  );
};

export default QualityButtons;
```

### 4.3 ProgressBar 组件 (进度条)

**功能**: 展示当前学习任务完成进度。

```jsx
// src/components/ProgressBar/index.jsx
import React from 'react';
import './styles.css';

const ProgressBar = ({ current, total }) => {
  const percentage = Math.min(100, Math.round((current / total) * 100));
  
  return (
    <div className="progress-container">
      <div className="progress-info">
        <span>进度：{current}/{total}</span>
        <span>{percentage}%</span>
      </div>
      <div className="progress-bar-bg">
        <div 
          className="progress-bar-fill" 
          style={{ width: `${percentage}%` }}
        />
      </div>
    </div>
  );
};

export default ProgressBar;
```

---

## 五、状态管理与 Hooks

### 5.1 学习逻辑封装 (useLearning)

**功能**: 管理单词队列、答题状态、API 交互。

```jsx
// src/hooks/useLearning.js
import { useState, useEffect } from 'react';
import { getTodayTasks, submitLearning } from '../services/learning';

export const useLearning = (dictId = 1) => {
  const [words, setWords] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [progress, setProgress] = useState({ completed: 0, total: 0 });
  const [isLoading, setIsLoading] = useState(false);
  const [isFinished, setIsFinished] = useState(false);
  
  useEffect(() => {
    loadTasks();
  }, [dictId]);
  
  const loadTasks = async () => {
    setIsLoading(true);
    try {
      const response = await getTodayTasks({ dict_id: dictId, limit: 20 });
      const { words: taskWords, review_count, new_count } = response.data;
      
      setWords(taskWords);
      setProgress({
        completed: 0,
        total: taskWords.length
      });
      setIsFinished(taskWords.length === 0);
    } catch (error) {
      console.error('Failed to load tasks:', error);
      alert('加载任务失败，请重试');
    } finally {
      setIsLoading(false);
    }
  };
  
  const submitAnswer = async (data) => {
    setIsLoading(true);
    try {
      await submitLearning(data);
      setProgress(prev => ({
        ...prev,
        completed: prev.completed + 1
      }));
    } catch (error) {
      console.error('Failed to submit answer:', error);
      alert('提交失败，请重试');
    } finally {
      setIsLoading(false);
    }
  };
  
  const loadNextWord = () => {
    if (currentIndex + 1 >= words.length) {
      setIsFinished(true);
    } else {
      setCurrentIndex(prev => prev + 1);
    }
  };
  
  return {
    currentWord: words[currentIndex],
    progress,
    isLoading,
    isFinished,
    submitAnswer,
    loadNextWord
  };
};
```

---

## 六、页面流程与交互

### 6.1 学习主流程

```
[进入学习页] 
    ↓
[调用 API 获取今日任务] 
    ↓
[加载 WordCard 组件] 
    ↓
[用户点击"显示释义"] 
    ↓
[展示 QualityButtons] 
    ↓
[用户选择评分 (0-5)] 
    ↓
[调用 API 提交结果] 
    ↓
[加载下一个单词] → (若无单词) → [展示完成页面]
```

### 6.2 上传任务流程

```
[选择文件] 
    ↓
[调用上传 API] 
    ↓
[获取 task_id] 
    ↓
[启动定时器轮询状态 API] 
    ↓
[更新进度条 UI] 
    ↓
[状态变为 completed] → [停止轮询] → [跳转词典列表]
```

---

## 七、前端开发任务拆解

### Day 1-2：项目初始化与基础组件
- [x] React 项目初始化 (Create React App / Vite)
- [x] Axios 请求封装
- [x] 全局样式变量配置
- [x] WordCard 组件开发
- [x] QualityButtons 组件开发

### Day 3-4：词典上传功能
- [x] 文件上传页面布局
- [x] 上传接口对接
- [x] 进度轮询逻辑实现
- [x] 词典列表页面展示

### Day 5-6：学习功能核心
- [x] useLearning Hook 编写
- [x] 学习页面布局集成
- [x] 答题提交逻辑对接
- [x] 完成状态页面开发

### Day 7：优化与测试
- [x] 加载状态 (Loading) 优化
- [x] 错误提示 (Toast/Modal) 统一
- [x] 移动端适配检查
- [x] 代码清理与注释

---

## 八、配置与部署

### 8.1 环境变量 (.env)

```bash
# 开发环境
REACT_APP_API_BASE_URL=http://localhost:8000/api/v1
REACT_APP_WS_URL=ws://localhost:8000/ws

# 生产环境 (构建时替换)
# REACT_APP_API_BASE_URL=https://api.example.com/api/v1
```

### 8.2 构建优化

- **代码分割**: 使用 `React.lazy` 加载非首屏页面
- **静态资源**: 图片/图标使用 SVG 或 CDN
- **打包分析**: 使用 `webpack-bundle-analyzer` 检查包大小

### 8.3 部署检查清单

- [ ] 前端构建优化 (npm run build)
- [ ] Nginx 静态资源配置
- [ ] 跨域 (CORS) 确认 (由后端配置，前端验证)
- [ ]  sourcemap 上传 (用于错误监控)
- [ ] 浏览器兼容性测试 (Chrome, Safari, Mobile)

---

## 九、关键技术决策 (前端)

### A. 为什么选择 React？
- 组件化开发适合卡片式学习界面
- 生态丰富 (Hooks, Router, State Management)
- 团队熟悉度高

### B. 为什么学习逻辑放在 Hook 中？
- 便于逻辑复用 (未来可能在多个页面使用学习逻辑)
- 将 UI 与业务逻辑分离，便于测试
- 后端负责核心算法计算，前端只负责状态流转

### C. 移动端适配策略
- 使用 REM 单位或 Flexbox 布局
- 媒体查询适配不同屏幕宽度
- 触摸事件优化 (防止点击延迟)

---

**文档版本**: v1.0  
**最后更新**: 2024-02-16  
**维护者**: 产品团队
